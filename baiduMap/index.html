<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		
		<style>
		html{
			height: 100%;
		}
		body{
			height: 100%;
			margin: 0;
			padding: 0;
		}
		#mapView{
			height: 90%;
			width: 80%;
			display: inline-block;
			float: left;
		}
		#r-result{
			display: inline-block;
			float: left;
			border: 1px solid black;
			
		}
		
		
		</style>
	<script src="http://api.map.baidu.com/api?v=2.0&ak=BPsmasMOajWqAeWXCudDNDPvgo0nm9i3" type="text/javascript"></script>
	</head>
	<body>
		<div id="mapView"></div>	
		
		<input type="text" id="line" />
		<button onclick="btnClick()">查询线路</button>
		<div id="r-result"></div>
	</body>
	
	<script>
	//初始化地图
		var map = new BMap.Map("mapView")
		
		var x=113.73499070055704;
		var y=34.72315
		var mapCenter = new BMap.Point(x,y)
		map.centerAndZoom(mapCenter,15)
	//用滚轮缩放地图
		map.enableScrollWheelZoom();
	//添加控件
		map.addControl(new BMap.NavigationControl());    
		map.addControl(new BMap.OverviewMapControl()); 
		map.addControl(new BMap.ScaleControl()); 
		map.addControl(new BMap.MapTypeControl());  
		
		
	//坐标转换对象
	var convertor = new BMap.Convertor();
	var p=[mapCenter]
	//坐标转换是一个异步任务，坐标参数必须是一个数组
	//回调函数中的data.points就是转换之后的坐标数组
	convertor.translate(p,1,5,function(data){
		//添加坐标点覆盖物
		var myIcon = new BMap.Icon("datouzhen.png",	
		new BMap.Size(40,40),
			{ 
			  anchor: new BMap.Size(20,40),
			  imageSize:new BMap.Size(40,40)
			}
	)
		var marker = new BMap.Marker(data.points[0],{icon:myIcon}); 
		map.addOverlay(marker);
		
		//使标注可以拖拽
		marker.enableDragging()
		//根据坐标得到百度经纬度
		marker.addEventListener("dragend", function(e){    
		 console.log("当前经度：" + e.point.lng + ",纬度： " + e.point.lat);    
		})
		
		
		var blockArray = [
			new BMap.Point(113.746287,34.729549),
			new BMap.Point(113.749835,34.729586),
			new BMap.Point(113.749844,34.727176),
			new BMap.Point(113.746323,34.727131),
			
		]
		
		var polyLine = new BMap.Polygon(blockArray,
			{
				strokeColor:"blue",
				strokeWeight:2, 
				strokeOpacity:0.5,
				fillColor:"red",
				fillOpacity:0.1
			}
		)
		map.addOverlay(polyLine)
	});
//获取地铁公交
	var busline = new BMap.BusLineSearch(map,{
		renderOptions:{map:map,panel:"r-result"},
			onGetBusListComplete: function(result){
			   if(result) {
				 var fstLine = result.getBusListItem(0);
				 busline.getBusLine(fstLine);
			   }
			}
	});
		
	function btnClick(){
		var line = document.getElementById("line").value;
		busline.getBusList(line);
	}
	
	
		
		
		
	
	</script>
</html>
